<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-71865250-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Hydra" href="/hydra/docs/opensearch.xml"><title data-react-helmet="true">Installation and Setup | ORY Hydra</title><meta data-react-helmet="true" name="docsearch:version" content="v1.5"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Installation and Setup | ORY Hydra"><meta data-react-helmet="true" name="description" content="The goal of this chapter is to introduce you to a fully functional set up that"><meta data-react-helmet="true" property="og:description" content="The goal of this chapter is to introduce you to a fully functional set up that"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//hydra/docs/configure-deploy"><link data-react-helmet="true" rel="shortcut icon" href="/hydra/docs/img/favico.png"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//hydra/docs/configure-deploy"><link rel="stylesheet" href="/hydra/docs/styles.a319347a.css">
<link rel="preload" href="/hydra/docs/styles.1c60314a.js" as="script">
<link rel="preload" href="/hydra/docs/runtime~main.691eece7.js" as="script">
<link rel="preload" href="/hydra/docs/main.4bab5e9b.js" as="script">
<link rel="preload" href="/hydra/docs/1.f98e3e54.js" as="script">
<link rel="preload" href="/hydra/docs/2.0472e4b4.js" as="script">
<link rel="preload" href="/hydra/docs/18b93cb3.7109bfac.js" as="script">
<link rel="preload" href="/hydra/docs/1be78505.c6dbc4ff.js" as="script">
<link rel="preload" href="/hydra/docs/f9e517e8.9e39b5a9.js" as="script">
<link rel="preload" href="/hydra/docs/88.d69e7072.js" as="script">
<link rel="preload" href="/hydra/docs/87.3c57ccbf.js" as="script">
<link rel="preload" href="/hydra/docs/f4edeb99.eb38510a.js" as="script">
<link rel="preload" href="/hydra/docs/17896441.a6bb28da.js" as="script">
<link rel="preload" href="/hydra/docs/4a816735.f34e45f8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="navbar__brand" to="https://www.ory.sh/hydra"><img class="navbar__logo" src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra"></a><a class="navbar__item navbar__link" href="/hydra/docs/index">Docs</a><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ecosystem</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat</a><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/hydra/docs/versions">v1.5</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="navbar__brand" to="https://www.ory.sh/hydra"><img class="navbar__logo" src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/hydra/docs/index">Docs</a></li><li class="menu__list-item"><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Ecosystem</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="menu__link">Forum</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Chat</a></li><li class="menu__list-item"><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/hydra/docs/versions">v1.5</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/install">Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/oauth2">OAuth 2.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/login-consent-flow">Hydra workflow</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Integrating Hydra into your stack</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/5min-tutorial">5 Minute Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/implementing-consent">Login, Consent &amp; Logout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/case-study">OAuth 2.0 Case Study</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/hydra/docs/configure-deploy">Installation and Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/dependencies-environment">Database Setup and Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/production">Preparing for Production</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/debugging">Common Problems &amp; Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/advanced">Advanced Topics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/integration">Consuming OAuth 2.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/reference/api">REST API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/sdk">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/sdk/go">Go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/sdk/js">JavaScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/sdk/php">PHP</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Further Reading</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/limitations">Limitations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/jwks">JSON Web Key Sets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/benchmark">Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/security-architecture">Security Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/faq">FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Kratos</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/kratos" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://www.ory.sh/kratos" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/kratos/docs" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://www.ory.sh/kratos/docs" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://github.com/ory/kratos" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Oathkeeper</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://www.ory.sh/oathkeeper" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper/docs" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://www.ory.sh/oathkeeper/docs" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://github.com/ory/oathkeeper" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Keto</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/keto" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://www.ory.sh/keto" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/keto/docs" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://www.ory.sh/keto/docs" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/keto" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://github.com/ory/keto" tabindex="-1">GitHub</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><div><span class="badge badge--secondary">Version: v1.5</span></div><header><h1 class="docTitle_1vWb">Installation and Setup</h1></header><div class="markdown"><p>The goal of this chapter is to introduce you to a fully functional set up that
includes ORY Hydra as well as our User Login &amp; Consent Provider reference
implementation.</p><p>The goal of this section is to familiarize you with the specifics of setting up
ORY Hydra in your environment. Before starting with this section, please check
out the <a href="hydra/5min-tutorial.md">tutorial</a>. It will teach you the most important
flows and settings for Hydra.</p><p>This guide will:</p><ol><li>Download and run a PostgreSQL container in Docker.</li><li>Download and run ORY Hydra in Docker.</li><li>Download and run our reference User Login &amp; Consent Provider.</li><li>Create an OAuth 2.0 Client to perform the OAuth 2.0 Authorize Code Flow.</li><li>Perform the OAuth 2.0 Authorize Code flow.</li></ol><p>Before starting with this guide, please install the most recent version of
<a href="https://www.docker.com/community-edition#/download" target="_blank" rel="noopener noreferrer">Docker</a>. While docker is
not required for running ORY Hydra, we recommend using it for this tutorial as
it will greatly reduce the complexity of setting up a database on your system
without virtualization, installing Go, and compiling ORY Hydra.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-network"></a>Create a Network<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-network" title="Direct link to heading">#</a></h2><p>Before we can start, a network must be created which we will attach all our
Docker containers to. That way, the containers can talk to one another.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker network create hydraguide</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="deploy-postgresql"></a>Deploy PostgreSQL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-postgresql" title="Direct link to heading">#</a></h2><p>For the purpose of this tutorial, we will use PostgreSQL as a database. As you
probably already know, don&#x27;t run databases in Docker in production! For the sake
of this tutorial however, let&#x27;s use Docker to quickly deploy the database.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --name ory-hydra-example--postgres </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">POSTGRES_USER</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">hydra </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">POSTGRES_PASSWORD</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">secret </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">POSTGRES_DB</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">hydra </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -d postgres:9.6</span></div></div></div></div></div><p>This command wil start a postgres instance with name
<code>ory-hydra-example--postgres</code>, set up a database called <code>hydra</code> and create a
user <code>hydra</code> with password <code>secret</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="deploy-ory-hydra"></a>Deploy ORY Hydra<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-ory-hydra" title="Direct link to heading">#</a></h2><p>We highly recommend using Docker to run Hydra, as installing, configuring and
running Hydra is easiest with Docker. ORY Hydra is available on
<a href="https://hub.docker.com/r/oryd/hydra/" target="_blank" rel="noopener noreferrer">Docker Hub</a>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The system secret can only be set against a fresh database. Key rotation is currently not supported. This</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># secret is used to encrypt the database and needs to be set to the same value every time the process (re-)starts.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can use /dev/urandom to generate a secret. But make sure that the secret must be the same anytime you define it.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You could, for example, store the value somewhere.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">SECRETS_SYSTEM</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable assign-left variable" style="color:rgb(191, 199, 213)">LC_CTYPE</span><span class="token variable operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">C</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">cat</span><span class="token variable" style="color:rgb(191, 199, 213)"> /dev/urandom </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">tr</span><span class="token variable" style="color:rgb(191, 199, 213)"> -dc </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;a-zA-Z0-9&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">fold</span><span class="token variable" style="color:rgb(191, 199, 213)"> -w </span><span class="token variable number" style="color:rgb(247, 140, 108)">32</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">head</span><span class="token variable" style="color:rgb(191, 199, 213)"> -n </span><span class="token variable number" style="color:rgb(247, 140, 108)">1</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Alternatively you can obviously just set a secret:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># $ export SECRETS_SYSTEM=this_needs_to_be_the_same_always_and_also_very_$3cuR3-._</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The database url points us at the postgres instance. This could also be an ephermal in-memory database (`export DSN=memory`)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># or a MySQL URI.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DSN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">postgres://hydra:secret@ory-hydra-example--postgres:5432/hydra?sslmode</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">disable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Before starting, let&#x27;s pull the latest ORY Hydra tag from docker.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker pull oryd/hydra:v1.5.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This command will show you all the environment variables that you can set. Read this carefully.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># It is the equivalent to `hydra help serve`.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -it --rm --entrypoint hydra oryd/hydra:v1.5.2 </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">help</span><span class="token plain"> serve</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Starts all HTTP/2 APIs and connects to a database backend.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ORY Hydra does not do magic, it requires conscious decisions, for example running SQL migrations which is required</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># when installing a new version of ORY Hydra, or upgrading an existing installation.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># It is the equivalent to `hydra migrate sql --yes postgres://hydra:secret@ory-hydra-example--postgres:5432/hydra?sslmode=disable`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -it --rm </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  oryd/hydra:v1.5.2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  migrate sql --yes </span><span class="token variable" style="color:rgb(191, 199, 213)">$DSN</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Applying </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable" style="color:rgb(191, 199, 213)">client</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain"> SQL migrations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Migration successful</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Let&#x27;s run the server (settings explained below):</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -d </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --name ory-hydra-example--hydra </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -p </span><span class="token number" style="color:rgb(247, 140, 108)">9000</span><span class="token plain">:4444 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -p </span><span class="token number" style="color:rgb(247, 140, 108)">9001</span><span class="token plain">:4445 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">SECRETS_SYSTEM</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$SECRETS_SYSTEM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DSN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$DSN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">URLS_SELF_ISSUER</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">https://localhost:9000/ </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">URLS_CONSENT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">http://localhost:9020/consent </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">URLS_LOGIN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">http://localhost:9020/login </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  oryd/hydra:v1.5.2 serve all</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># And check if it&#x27;s running:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker logs ory-hydra-example--hydra</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-29T21:26:26Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Connecting with postgres://*:*@postgres:5432/hydra?sslmode=disable&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-29T21:26:26Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Connected to SQL!&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-29T21:26:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Setting up http server on :4444&quot;</span></div></div></div></div></div><p>Let&#x27;s dive into the various settings:</p><ul><li><code>--network hydraguide</code> connects this instance to the network and makes it
possible to connect to the PostgreSQL database.</li><li><code>-p 9000:4444</code> exposes ORY Hydra&#x27;s public API on <code>https://localhost:9000/</code>.</li><li><code>-p 9001:4445</code> exposes ORY Hydra&#x27;s administrative API on
<code>https://localhost:9001/</code>.</li><li><code>-e SECRETS_SYSTEM=$SECRETS_SYSTEM</code> sets the system secret environment
variable <strong>(required)</strong>.</li><li><code>-e DSN=$DSN</code> sets the database url environment variable <strong>(required)</strong>.</li><li><code>-e URLS_SELF_ISSUER=https://localhost:9000/</code> this value must be set to the
publicly available URL of ORY Hydra <strong>(required)</strong>.</li><li><code>-e URLS_CONSENT=http://localhost:9020/consent</code> this sets the URL of the
consent provider <strong>(required)</strong>. We will set up the service that handles
requests at that URL in the next sections.</li><li><code>-e URLS_LOGIN=http://localhost:9020/login</code> this sets the URL of the login
provider <strong>(required)</strong>. We will set up the service that handles requests at
that URL in the next sections.</li></ul><p>Note: In this example we did not define a value for the optional setting
<code>OAUTH2_ERROR_URL</code>. This URL can be used to provide an endpoint which will
receive error messages from ORY Hydra that should be displayed to the end user.
The URL receives <code>error</code> and <code>error_description</code> parameters. If this value is
not set, Hydra uses the fallback endpoint <code>/oauth2/fallbacks/error</code> and displays
a default error message. In order to obtain a uniform UI, you might want to
include such an endpoint in your login or consent provider.</p><p>To confirm that the instance is running properly,
<a href="https://localhost:9001/health/ready" target="_blank" rel="noopener noreferrer">open the health check</a>. If asked, accept
the self signed certificate in your browser. You should simply see <code>ok</code>.</p><p>On start up, ORY Hydra is initializing some values. Let&#x27;s take a look at the
logs:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker logs ory-hydra-example--hydra</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-30T09:06:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Connecting with postgres://*:*@postgres:5432/hydra?sslmode=disable&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-30T09:06:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Connected to SQL!&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-30T09:06:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Key pair for signing hydra.openid.id-token is missing. Creating new one.&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-30T09:06:41Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">warning </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;No TLS Key / Certificate for HTTPS found. Generating self-signed certificate.&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2017-06-30T09:06:41Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Setting up http server on :4444&quot;</span></div></div></div></div></div><p>As you can see, the following steps are performed when running ORY Hydra against
a fresh database:</p><ol><li>If no system secret was given (in our case we provided one), a random one is
generated and emitted to the logs. Note this down, otherwise you won&#x27;t be
able to restart Hydra.</li><li>Cryptographic keys are generated for the OpenID Connect ID Token, the consent
challenge and response, and TLS encryption using a self-signed certificate,
which is why we need to run all commands using <code>--skip-tls-verify</code>.</li></ol><p>ORY Hydra can be managed using the Hydra Command Line Interface (CLI), which is
using ORY Hydra&#x27;s REST APIs. To see the available commands, run:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run --rm -it --entrypoint hydra oryd/hydra:v1.5.2 </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">help</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Hydra is a cloud native high throughput OAuth2 and OpenID Connect provider</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  hydra </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="deploy-login--consent-app"></a>Deploy Login &amp; Consent App<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-login--consent-app" title="Direct link to heading">#</a></h2><p>The Login Provider and Consent Provider can be two separate web services. We
provide a
<a href="https://github.com/ory/hydra-login-consent-node" target="_blank" rel="noopener noreferrer">reference implementation</a>
which combines both features in one app. Here, we will use deploy that app using
Docker.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker pull oryd/hydra-login-consent-node:v1.3.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run -d </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --name ory-hydra-example--consent </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -p </span><span class="token number" style="color:rgb(247, 140, 108)">9020</span><span class="token plain">:3000 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">HYDRA_ADMIN_URL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">https://ory-hydra-example--hydra:4445 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">NODE_TLS_REJECT_UNAUTHORIZED</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  oryd/hydra-login-consent-node:v1.3.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Let&#x27;s check if it&#x27;s running ok:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker logs ory-hydra-example--consent</span></div></div></div></div></div><p>Let&#x27;s take a look at the arguments:</p><ul><li><code>-p 9020:3000</code> exposes this service at port 9020. If you remember, that&#x27;s the
port of the <code>URLS_CONSENT</code> and <code>URLS_LOGIN</code> value from the ORY Hydra docker
container (<code>URLS_CONSENT=http://localhost:9020/consent</code>,
<code>URLS_LOGIN=http://localhost:9020/login</code>).</li><li><code>HYDRA_ADMIN_URL=http://hydra:4445</code> point to the ORY Hydra Administrative API.</li><li><code>NODE_TLS_REJECT_UNAUTHORIZED=0</code> disables TLS verification, because we are
using self-signed certificates.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="perform-oauth-20-flow"></a>Perform OAuth 2.0 Flow<a aria-hidden="true" tabindex="-1" class="hash-link" href="#perform-oauth-20-flow" title="Direct link to heading">#</a></h2><p>Great! Our infrastructure is all set up! Next it&#x27;s time to perform the OAuth 2.0
Authorize Code flow. For that purpose, the ORY Hydra CLI has a feature that sets
up an OAuth 2.0 Consumer and an OAuth 2.0 callback URL. Typically, this would be
a third-party application that requests access to a user&#x27;s resources on your
servers - for example a Facebook App you wrote that backs up a user&#x27;s photos and
thus requires read access to the user&#x27;s photos.</p><p>Before we go ahead, the OAuth 2.0 Client that performs the request has to be set
up. Let&#x27;s call the client <code>facebook-photo-backup</code>. We have to specify which
OAuth 2.0 Grant Types, OAuth 2.0 Scope, OAuth 2.0 Response Types, and Callback
URLs the client may request:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run --rm -it </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">HYDRA_ADMIN_URL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">https://ory-hydra-example--hydra:4445 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  oryd/hydra:v1.5.2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  clients create --skip-tls-verify </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --id facebook-photo-backup </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --secret some-secret </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --grant-types authorization_code,refresh_token,client_credentials,implicit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --response-types token,code,id_token </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --scope openid,offline,photos.read </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --callbacks http://127.0.0.1:9010/callback</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Client facebook-photo-backup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Client Secret: some-secret</span></div></div></div></div></div><p>Let&#x27;s dive into some of the arguments:</p><ul><li><code>--skip-tls-verify</code> is supported by all management commands
(create/delete/update/... OAuth 2.0 Client, JSON Web Key, ...) and tells the
CLI to trust any certificate authority - even self-signed ones. We need this
flag because the server uses a self-signed certificate. In production
deployments, you would use a certificate signed by a trusted CA.</li><li><code>--grant-types authorize_code,refresh_token,client_credentials,implicit</code> we
want to be able to perform all of these OAuth 2.0 flows.</li><li><code>--response-types token,code,id_token</code> allows us to receive authorize codes,
access and refresh tokens, and OpenID Connect ID Tokens.</li><li><code>--scope openid,offline,photos.read</code> allows the client to request various
permissions:<ul><li><code>openid</code> allows the client to perform the OpenID Connect flow and request an
OpenID Connect ID Token.</li><li><code>offline</code> allows the client to request a refresh token. Because we want to
continuously backup photos, the app must be able to refresh expired access
tokens. This scope allows that.</li><li><code>photos.read</code> this is an imaginary scope that is not handled by ORY Hydra
but serves the purpose of making it clear that we could request read access
to a user&#x27;s photos. You can obviously omit this scope or use your own scope.</li></ul></li><li><code>--callbacks http://localhost:9010/callback</code> allows the client to request this
redirect uri.</li></ul><p>Perfect, let&#x27;s perform an exemplary OAuth 2.0 Authorize Code Flow! To make this
easy, the ORY Hydra CLI provides a helper command called <code>hydra token user</code>.
Just imagine this being, for example, passport.js that is generating an auth
code url, redirecting the browser to it, and then exchanging the authorize code
for an access token. The same thing happens with this command:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run --rm -it </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -p </span><span class="token number" style="color:rgb(247, 140, 108)">9010</span><span class="token plain">:9010 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  oryd/hydra:v1.5.2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  token user --skip-tls-verify </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --port </span><span class="token number" style="color:rgb(247, 140, 108)">9010</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --auth-url https://localhost:9000/oauth2/auth </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --token-url https://ory-hydra-example--hydra:4444/oauth2/token </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --client-id facebook-photo-backup </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --client-secret some-secret </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --scope openid,offline,photos.read</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Setting up callback listener on http://localhost:9010/callback</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Press ctrl + c on Linux / Windows or cmd + c on OSX to end the process.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">If your browser does not </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> automatically, navigate to:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        https://localhost:9010/</span></div></div></div></div></div><p>open the link, as prompted, in your browser, and follow the steps shown there.
You might encounter a screen like the following one:</p><img alt="Insecure connection" src="/hydra/docs/images/docs/hydra/insecure-connection.png">;<p>This happens because we run ORY Hydra with a self-signed TLS certificate. In
production deployments, you would probably use a certificate signed by a trusted
CA and not see this screen.</p><p>When you see this screen, click on &quot;Advanced&quot; and &quot;Add Exception&quot; to continue.
In some browsers, this might work differently, but it&#x27;s always possible to
proceed.</p><p>When completed, you should land at a screen that looks like this one:</p><img alt="OAuth 2.0 result" src="/hydra/docs/images/docs/hydra/install-result.png">;</div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/hydra/edit/master/docs/versioned_docs/version-v1.5/configure-deploy.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-06-23T09:17:49.000Z" class="docLastUpdatedAt_1sqk">6/23/2020</time> by <strong>aeneasr</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/hydra/docs/case-study"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label"> OAuth 2.0 Case Study</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/hydra/docs/dependencies-environment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Database Setup and Configuration </div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-network" class="table-of-contents__link">Create a Network</a></li><li><a href="#deploy-postgresql" class="table-of-contents__link">Deploy PostgreSQL</a></li><li><a href="#deploy-ory-hydra" class="table-of-contents__link">Deploy ORY Hydra</a></li><li><a href="#deploy-login--consent-app" class="table-of-contents__link">Deploy Login &amp; Consent App</a></li><li><a href="#perform-oauth-20-flow" class="table-of-contents__link">Perform OAuth 2.0 Flow</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright  2020 ORY GmbH</div></div></div><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>document.querySelectorAll(".tabs .tabs-nav .nav-item a").forEach((function(t){t.addEventListener("click",(function(e){return e.preventDefault(),t.closest(".tabs-nav").querySelectorAll(".nav-item a").forEach((function(t){t.classList.remove("active")})),t.closest(".tabs").querySelectorAll(".tab-content .tab-pane").forEach((function(t){t.classList.remove("active")})),t.classList.add("active"),document.getElementById(t.href.split("#")[1]).classList.add("active"),!1}))}))</script></footer></div>
<script src="/hydra/docs/styles.1c60314a.js"></script>
<script src="/hydra/docs/runtime~main.691eece7.js"></script>
<script src="/hydra/docs/main.4bab5e9b.js"></script>
<script src="/hydra/docs/1.f98e3e54.js"></script>
<script src="/hydra/docs/2.0472e4b4.js"></script>
<script src="/hydra/docs/18b93cb3.7109bfac.js"></script>
<script src="/hydra/docs/1be78505.c6dbc4ff.js"></script>
<script src="/hydra/docs/f9e517e8.9e39b5a9.js"></script>
<script src="/hydra/docs/88.d69e7072.js"></script>
<script src="/hydra/docs/87.3c57ccbf.js"></script>
<script src="/hydra/docs/f4edeb99.eb38510a.js"></script>
<script src="/hydra/docs/17896441.a6bb28da.js"></script>
<script src="/hydra/docs/4a816735.f34e45f8.js"></script>
</body>
</html>