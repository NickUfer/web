<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-71865250-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Hydra" href="/hydra/docs/opensearch.xml"><title data-react-helmet="true">Advanced Topics | ORY Hydra</title><meta data-react-helmet="true" name="docsearch:version" content="v1.5"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Advanced Topics | ORY Hydra"><meta data-react-helmet="true" name="description" content="This guide aims to help setting up a production system with ORY Hydra."><meta data-react-helmet="true" property="og:description" content="This guide aims to help setting up a production system with ORY Hydra."><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//hydra/docs/v1.5/advanced"><link data-react-helmet="true" rel="shortcut icon" href="/hydra/docs/img/favico.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//hydra/docs/v1.5/advanced"><link rel="stylesheet" href="/hydra/docs/styles.771dd22a.css">
<link rel="preload" href="/hydra/docs/styles.6111e368.js" as="script">
<link rel="preload" href="/hydra/docs/runtime~main.2a596a0f.js" as="script">
<link rel="preload" href="/hydra/docs/main.dd4aba0b.js" as="script">
<link rel="preload" href="/hydra/docs/2.d59282e2.js" as="script">
<link rel="preload" href="/hydra/docs/3.166acb7c.js" as="script">
<link rel="preload" href="/hydra/docs/1be78505.331aa41c.js" as="script">
<link rel="preload" href="/hydra/docs/f9e517e8.d3a3116c.js" as="script">
<link rel="preload" href="/hydra/docs/256.4df904be.js" as="script">
<link rel="preload" href="/hydra/docs/255.4e0cfe55.js" as="script">
<link rel="preload" href="/hydra/docs/b54541be.e91639e2.js" as="script">
<link rel="preload" href="/hydra/docs/17896441.3874ea07.js" as="script">
<link rel="preload" href="/hydra/docs/e79af006.89b09352.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/hydra/docs/">Docs</a><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ecosystem</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat</a><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/hydra/docs/versions">v1.7</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/hydra/docs/">Docs</a></li><li class="menu__list-item"><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Ecosystem</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="menu__link">Forum</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Chat</a></li><li class="menu__list-item"><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/hydra/docs/versions">v1.7</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/install">Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/oauth2">OAuth 2.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/login-consent-flow">Hydra workflow</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Integrating Hydra into your stack</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/5min-tutorial">5 Minute Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/implementing-consent">Login, Consent &amp; Logout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/case-study">OAuth 2.0 Case Study</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/configure-deploy">Installation and Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/dependencies-environment">Database Setup and Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/production">Preparing for Production</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/debugging">Common Problems &amp; Debugging</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/hydra/docs/v1.5/advanced">Advanced Topics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/integration">Consuming OAuth 2.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/reference/api">REST API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/sdk">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/sdk/go">Go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/sdk/js">JavaScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/sdk/php">PHP</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Further Reading</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/limitations">Limitations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/jwks">JSON Web Key Sets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/benchmark">Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/security-architecture">Security Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hydra/docs/v1.5/faq">FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Kratos</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/kratos" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/kratos/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Oathkeeper</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Keto</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/keto/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for ORY Hydra <strong>vv1.5</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/hydra/docs/advanced">latest version</a></strong> (v1.7).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: v1.5</span></div><header><h1 class="docTitle_1Lrw">Advanced Topics</h1></header><div class="markdown"><p>This guide aims to help setting up a production system with ORY Hydra.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="self-signed-ssl"></a>Self-Signed SSL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#self-signed-ssl" title="Direct link to heading">#</a></h2><p>If you want to run ORY Hydra using self-signed TLS certificates, you can do the
following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ openssl genrsa -out key.pem 4096</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ openssl req -new -x509 -sha256 -key key.pem -out cert.crt -days 365</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ SERVE_TLS_CERT_BASE64=$(base64 -i cert.crt)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ SERVE_TLS_KEY_BASE64=$(base64 -i key.pem)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># or</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ SERVE_TLS_KEY_PATH=/path/to/key.pem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ SERVE_TLS_CERT_PATH=/path/to/cert.crt</span></div></div></div></div></div><p>If you run Docker locally, you can then use</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ docker run ... \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -e SERVE_TLS_CERT_BASE64=$(SERVE_TLS_CERT_BASE64) \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -e SERVE_TLS_KEY_BASE64=$(SERVE_TLS_KEY_BASE64) \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div></div></div></div></div><p>or mount the files using <code>--mount</code> and linking to the files.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="mobile--browser-spa-authorization"></a>Mobile &amp; Browser (SPA) Authorization<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mobile--browser-spa-authorization" title="Direct link to heading">#</a></h2><p>We have an
<a href="https://www.ory.sh/oauth2-for-mobile-app-spa-browser" target="_blank" rel="noopener noreferrer">excellent blog post</a> on
this topic. Read it now!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="creating-a-public-oauth-20-client"></a>Creating a public OAuth 2.0 Client<a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-a-public-oauth-20-client" title="Direct link to heading">#</a></h3><p>You can create a public OAuth 2.0 Client (e.g. for the authorize code + PKCE or
implicit flow) with the CLI</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">hydra clients create --endpoint http://ory-hydra-admin-api --token-endpoint-auth-method none</span></div></div></div></div></div><p>or by setting in the HTTP API JSON body when POSTing to <code>/clients</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;client_id&quot;: &quot;...&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;token_endpoint_auth_method&quot;: &quot;none&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Be aware that when making requests to <code>/oauth2/token</code> or <code>/oauth2/revoke</code> with a
public OAuth 2.0 Client, you can not authenticate with the HTTP Basic
Authorization but must include the <code>client_id</code> in the POST body.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="key-rotation"></a>Key rotation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#key-rotation" title="Direct link to heading">#</a></h2><p>There are two types of key rotation:</p><ul><li>Rotation of JSON Web Token Signing Keys</li><li>Rotation of HMAC Token Signing and Database and Cookie Encryption Keys</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="rotation-of-json-web-token-signing-keys"></a>Rotation of JSON Web Token Signing Keys<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rotation-of-json-web-token-signing-keys" title="Direct link to heading">#</a></h3><p>JSON Web Token Signing Key rotation is simple with ORY Hydra. You can rotate
OpenID Connect ID Token and OAuth 2.0 Access Tokens, when using the JSON Web
Token strategy, keys with one simple command.</p><p>ORY Hydra takes the latest key from the key store to sign JSON Web Tokens. All
public keys will be shown at
<code>http://ory-hydra-public-api/.well-known/jwks.json</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="openid-connect-id-token"></a>OpenID Connect ID Token<a aria-hidden="true" tabindex="-1" class="hash-link" href="#openid-connect-id-token" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">hydra keys create --endpoint=http://ory-hydra-admin-api/ hydra.openid.id-token -a RS256</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="oauth-20-access-tokens-json-web-token"></a>OAuth 2.0 Access Tokens (JSON Web Token)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#oauth-20-access-tokens-json-web-token" title="Direct link to heading">#</a></h4><blockquote><p>This will only work when using the JWT access token strategy. Otherwise, this
will have no effect.</p></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">hydra keys create --endpoint=http://ory-hydra-admin-api/ hydra.jwt.access-token -a RS256</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="rotation-of-hmac-token-signing-and-database-and-cookie-encryption-keys"></a>Rotation of HMAC Token Signing and Database and Cookie Encryption Keys<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rotation-of-hmac-token-signing-and-database-and-cookie-encryption-keys" title="Direct link to heading">#</a></h3><p>Rotating database encryption keys is done by prepending the new encryption key
to the respective configuration value. Assuming configuration</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">secrets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">cookie</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> the</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">old</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cookie</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> the</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">old</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key</span></div></div></div></div></div><p>one would add the new keys as follows</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">secrets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">cookie</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> the</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cookie</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the new key must be the first entry</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> the</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">old</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cookie</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> the</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the new key must be the first entry</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> the</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">old</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key</span></div></div></div></div></div><blockquote><p>It is very important that the new key is the first entry in the list as only
the first key is used for encryption while all keys from the list are used for
decryption. Please note that existing data will not be automatically
re-encrypted using the new key. Only new data will be signed and encrypted
using the new key. It is therefore imperative that the old key is added to the
list, unless you want to also invalidate all data that was signed or encrypted
using the old key.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="oauth-20"></a>OAuth 2.0<a aria-hidden="true" tabindex="-1" class="hash-link" href="#oauth-20" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="audience"></a>Audience<a aria-hidden="true" tabindex="-1" class="hash-link" href="#audience" title="Direct link to heading">#</a></h3><p>There are two types of audience concept in the context of OAuth 2.0 and OpenID
Connect:</p><ol><li>OAuth 2.0: Access and Refresh Tokens are &quot;internal-facing&quot;. The <code>aud</code> claim
of an OAuth 2.0 Access and Refresh token defines at which <em>endpoints</em> the
token can be used.</li><li>OpenID Connect: The ID Token is &quot;external-facing&quot;. The <code>aud</code> claim of an
OpenID Connect ID Token defines which <em>clients</em> should accept it.</li></ol><p>While modifying the audience of an ID Token is not desirable, specifying the
audience of an OAuth 2.0 Access Token is. This is not defined as an IETF
Standard but is considered good practice in certain environments.</p><p>For this reason, Hydra allows you to control the aud claim of the access token.
To do so, you must specify the intended audiences in the OAuth 2.0 Client&#x27;s
metadata on a per-client basis:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;client_id&quot;: &quot;...&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;audience&quot;: [&quot;https://api.my-cloud.com/user&quot;, &quot;https://some-tenant.my-cloud.com/&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>The audience is a list of case-sensitive URLs. <strong>URLs must not contain
whitespaces</strong>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="oauth-20-authorization-code-implicit-hybrid-flows"></a>OAuth 2.0 Authorization Code, Implicit, Hybrid Flows<a aria-hidden="true" tabindex="-1" class="hash-link" href="#oauth-20-authorization-code-implicit-hybrid-flows" title="Direct link to heading">#</a></h4><p>When performing an OAuth 2.0 authorize code, implicit, or hybrid flow, you can
request audiences at the <code>/oauth2/auth</code> endpoint
<code>https://my-hydra.com/oauth2/auth?client_id=...&amp;scope=...&amp;audience=https%3A%2F%2Fapi.my-cloud.com%2Fuser+https%3A%2F%2Fsome-tenant.my-cloud.com%2F</code>
which requests audiences <code>https://api.my-cloud.com/user</code> and
<code>https://some-tenant.my-cloud.com/</code>.</p><p>The <code>audience</code> query parameter may contain multiple strings separated by a
url-encoded space (<code>+</code> or <code>%20</code>). The audience values themselves must also be
url encoded. The values will be validated against the whitelisted audiences
defined in the OAuth 2.0 Client:</p><ul><li>An OAuth 2.0 Client with the allowed audience <code>https://api.my-cloud/user</code> is
allowed to request audience values <code>https://api.my-cloud/user</code><code>https://api.my-cloud/user/1234</code> but not <code>https://api.my-cloud/not-user</code> nor
<code>https://something-else/</code>.</li></ul><p>The requested audience from the query parameter is then part of the login and
consent request payload as field <code>requested_access_token_audience</code>. You can then
alter the audience using <code>grant_audience.access_token</code> when accepting the
consent request:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">hydra.acceptConsentRequest(challenge, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ORY Hydra checks if requested audiences are allowed by the client, so we can simply echo this.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  grant_audience: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access_token: response.requested_access_token_audience,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // or, for example:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // access_token: [&quot;https://api.my-cloud/not-user&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ... remember: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div></div></div><p>When introspecting the OAuth 2.0 Access Token, the response payload will include
the audience:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;active&quot;: true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;audience&quot;: [&quot;https://api.my-cloud/user&quot;, &quot;https://api.my-cloud/user/1234&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="oauth-20-client-credentials-grant"></a>OAuth 2.0 Client Credentials Grant<a aria-hidden="true" tabindex="-1" class="hash-link" href="#oauth-20-client-credentials-grant" title="Direct link to heading">#</a></h4><p>When performing the client credentials grant, the audience parameter from the
POST body of the <code>/oauth2/token</code> is decoded and validated according to the same
rules of the previous section, except for the login and consent part which does
not exist for this flow.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="json-web-tokens"></a>JSON Web Tokens<a aria-hidden="true" tabindex="-1" class="hash-link" href="#json-web-tokens" title="Direct link to heading">#</a></h3><p>ORY Hydra issues opaque OAuth 2.0 Access Tokens per default for the following
reasons:</p><ol><li><strong>OAuth 2.0 Access Tokens represent internal state but are public
knowledge:</strong> An Access Token often contains internal data (e.g. session data)
or other sensitive data (e.g. user roles and permissions) and is sometimes
used as a means of transporting system-relevant information in a stateless
manner. Therefore, making these tokens transparent (by using JSON Web Tokens
as Access Tokens) comes with risk of exposing this information accidentally,
and with the downside of not storing this information in the OAuth 2.0 Access
Token at all.</li><li><strong>JSON Web Tokens can not hold secrets:</strong> Unless encrypted, JSON Web Tokens
can be read by everyone, including 3rd Parties. Therefore, they can not keep
secrets. This point is similar to (1), but it is important to stress this.</li><li><strong>Access Tokens as JSON Web Tokens can not be revoked:</strong> Well, you can revoke
them, but they will be considered valid until the &quot;expiry&quot; of the token is
reached. Unless, of course, you have a blacklist or check with Hydra if the
token was revoked, which however defeats the purpose of using JSON Web Tokens
in the first place.</li><li><strong>Certain OpenID Connect features will not work</strong> when using JSON Web Tokens
as Access Tokens, such as the pariwise subject identifier algorithm.</li><li><strong>There is a better solution: Use
<a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer">ORY Oathkeeper</a>!</strong> ORY Oathkeeper is a
proxy you deploy in front of your services. It will &quot;convert&quot; ORY Hydra&#x27;s
opaque Access Tokens into JSON Web Tokens for your backend services. This
allows your services to work without additional REST Calls while solving all
previous points. <strong>We really recommend this option if you want JWTs!</strong></li></ol><p>If you are not convinced that ORY Oathkeeper is the right tool for the job, you
can still enable JSON Web Tokens in ORY Hydra by setting:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">strategies</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">access_token</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> jwt</span></div></div></div></div></div><p>Be aware that only access tokens are formatted as JSON Web Tokens. Refresh
tokens are not impacted by this strategy. By performing OAuth 2.0 Token
Introspection you can check if the token is still valid. If a token is revoked
or otherwise blacklisted, the OAuth 2.0 Token Introspection will return
<code>{ &quot;active&quot;: false }</code>. This is useful when you do not want to rely only on the
token&#x27;s expiry.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="json-web-token-validation"></a>JSON Web Token Validation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#json-web-token-validation" title="Direct link to heading">#</a></h4><p>You can validate JSON Web Tokens issued by ORY Hydra by pointing your <code>jwt</code>
library (e.g. <a href="https://github.com/auth0/node-jwks-rsa" target="_blank" rel="noopener noreferrer">node-jwks-rsa</a>) to
<code>http://ory-hydra-public-api/.well-known/jwks.json</code>. All necessary keys are
available there.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="oauth-20-client-authentication-with-privatepublic-keypairs"></a>OAuth 2.0 Client Authentication with private/public keypairs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#oauth-20-client-authentication-with-privatepublic-keypairs" title="Direct link to heading">#</a></h3><p>ORY Hydra supports OAuth 2.0 Client Authentication with RSA and ECDSA
private/public keypairs with currently supported signing algorithms:</p><ul><li>RS256 (default), RS384, RS512</li><li>PS256, PS384, PS512</li><li>ES256, ES384, ES512</li></ul><p>This authentication method replaces the classic HTTP Basic Authorization and
HTTP POST Authorization schemes. Instead of sending the <code>client_id</code> and
<code>client_secret</code>, you authenticate the client with a signed JSON Web Token.</p><p>To enable this feature for a specific OAuth 2.0 Client, you must set
<code>token_endpoint_auth_method</code> to <code>private_key_jwt</code> and register the public key of
the RSA/ECDSA signing key either using the <code>jwks_uri</code> or <code>jwks</code> fields of the
client.</p><p>When authenticating the client at the token endpoint, you generate and sign
(with the RSA/ECDSA private key) a JSON Web Token with the following claims:</p><ul><li><code>iss</code>: REQUIRED. Issuer. This MUST contain the client_id of the OAuth Client.</li><li><code>sub</code>: REQUIRED. Subject. This MUST contain the client_id of the OAuth Client.</li><li><code>aud</code>: REQUIRED. Audience. The aud (audience) Claim. Value that identifies the
Authorization Server (ORY Hydra) as an intended audience. The Authorization
Server MUST verify that it is an intended audience for the token. The Audience
SHOULD be the URL of the Authorization Server&#x27;s Token Endpoint.</li><li><code>jti</code>: REQUIRED. JWT ID. A unique identifier for the token, which can be used
to prevent reuse of the token. These tokens MUST only be used once, unless
conditions for reuse were negotiated between the parties; any such negotiation
is beyond the scope of this specification.</li><li><code>exp</code>: REQUIRED. Expiration time on or after which the ID Token MUST NOT be
accepted for processing.</li><li><code>iat</code>: OPTIONAL. Time at which the JWT was issued.</li></ul><p>When making a request to the <code>/oauth2/token</code> endpoint, you include
<code>client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</code>
and <code>client_assertion=&lt;signed-jwt&gt;</code> in the request body:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">POST /oauth2/token HTTP/1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Host: my-hydra.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">grant_type=authorization_code&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">code=i1WsRn1uB1&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">client_id=s6BhdRkqt3&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">client_assertion_type=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&amp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">client_assertion=PHNhbWxwOl ... ZT</span></div></div></div></div></div><p>Here&#x27;s what a client with a <code>jwks</code> containing one RSA public key looks like:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;client_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rsa-client-jwks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;jwks&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;keys&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;kty&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RSA&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;n&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;jL7h5wc-yeMUsHGJHc0xe9SbTdaLKXMHvcIHQck20Ji7SvrHPdTDQTvZtTDS_wJYbeShcCrliHvbJRSZhtEe0mPJpyWg3O_HkKy6_SyHepLK-_BR7HfcXYB6pVJCG3BW-lVMY7gl5sULFA74kNZH50h8hdmyWC9JgOHn0n3YLdaxSWlhctuwNPSwqwzY4qtN7_CZub81SXWpKiwj4UpyB10b8rM8qn35FS1hfsaFCVi0gQpd4vFDgFyqqpmiwq8oMr8RZ2mf0NMKCP3RXnMhy9Yq8O7lgG2t6g1g9noWbzZDUZNc54tv4WGFJ_rJZRz0jE_GR6v5sdqsDTdjFquPlQ&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;e&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AQAB&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;use&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sig&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;kid&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rsa-jwk&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_endpoint_auth_method&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;private_key_jwt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_endpoint_auth_signing_alg&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RS256&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>And here is how it looks like for a <code>jwks</code> including an ECDSA public key:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;client_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ecdsa-client-jwks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;jwks&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;keys&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;kty&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;EC&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;use&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sig&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;crv&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;P-256&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;kid&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ecdsa-jwk&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;x&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nQjdhpecjZRlworpYk_TJAQBe4QbS8IwHY1DWkfR0w0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;y&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;UQfLzHxhc4i3EETUeaAS1vDVFJ-Y01hIESiXqqS86Vc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_endpoint_auth_method&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;private_key_jwt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_endpoint_auth_signing_alg&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ES256&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>And with <code>jwks_uri</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;client_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;client-jwks-uri&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;jwks_uri&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://path-to-my-public/keys.json&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_endpoint_auth_method&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;private_key_jwt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;token_endpoint_auth_signing_alg&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RS256&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>The <code>jwks_uri</code> must return a JSON object containing the public keys associated
with the OAuth 2.0 Client:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;keys&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;kty&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RSA&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;n&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;jL7h5wc-yeMUsHGJHc0xe9SbTdaLKXMHvcIHQck20Ji7SvrHPdTDQTvZtTDS_wJYbeShcCrliHvbJRSZhtEe0mPJpyWg3O_HkKy6_SyHepLK-_BR7HfcXYB6pVJCG3BW-lVMY7gl5sULFA74kNZH50h8hdmyWC9JgOHn0n3YLdaxSWlhctuwNPSwqwzY4qtN7_CZub81SXWpKiwj4UpyB10b8rM8qn35FS1hfsaFCVi0gQpd4vFDgFyqqpmiwq8oMr8RZ2mf0NMKCP3RXnMhy9Yq8O7lgG2t6g1g9noWbzZDUZNc54tv4WGFJ_rJZRz0jE_GR6v5sdqsDTdjFquPlQ&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;e&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AQAB&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;use&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sig&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;kid&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rsa-jwk&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="openid-connect"></a>OpenID Connect<a aria-hidden="true" tabindex="-1" class="hash-link" href="#openid-connect" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="subject-identifier-algorithms"></a>Subject Identifier Algorithms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#subject-identifier-algorithms" title="Direct link to heading">#</a></h3><p>Hydra supports two
<a href="http://openid.net/specs/openid-connect-core-1_0.html#SubjectIDTypes" target="_blank" rel="noopener noreferrer">Subject Identifier Algorithms</a>:</p><ul><li><code>public</code>: This provides the same <code>sub</code> (subject) value to all Clients
(default).</li><li><code>pairwise</code>: This provides a different <code>sub</code> value to each Client, so as not to
enable Clients to correlate the End-User&#x27;s activities without permission.</li></ul><p>You can enable either one or both algorithms using the following configuration
layout:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subject_identifiers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pairwise</span></div></div></div></div></div><p>When <code>pairwise</code> is enabled, you must also set
<code>oidc.subject_identifiers.pairwise.salt</code>. The salt is used to obfuscate the
<code>sub</code> value:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subject_identifiers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pairwise</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">pairwise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">salt</span></div></div></div></div></div><p><strong>This value should not be changed once set in production. Changing it will
cause all client applications to receive new user IDs from ORY Hydra which will
lead to serious complications with authentication on their side!</strong></p><p>Each OAuth 2.0 Client has a configuration field <code>subject_type</code>. The value of
that <code>subject_type</code> is either <code>public</code> or <code>pairwise</code>. If the identifier
algorithm is enabled, ORY Hydra will choose the right strategy automatically.</p><p>While ORY Hydra handles <code>sub</code> obfuscation out of the box, you may also override
this value with your own obfuscated <code>sub</code> value by setting
<code>force_subject_identifier</code> when accepting the login challenge in your user login
app.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-login_hint-with-different-subject"></a>Using login_hint with Different Subject<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-login_hint-with-different-subject" title="Direct link to heading">#</a></h3><p>When a user already logged in with a subject(e.g. user-A), and she would like to
login as another user using login_hint(e.g. login_hint=user-B), directly
accepting the latter login request in your login provider will make hydra reply:
<code>Subject from payload does not match subject from previous authentication</code></p><p>The suggested flow is:</p><p>Check the response from
<a href="https://www.ory.sh/hydra/docs/reference/api#get-a-login-request" target="_blank" rel="noopener noreferrer">GET login request</a>,
if both the <code>subject</code> and <code>login_hint</code> are NOT empty and also NOT the same user,
redirect UserAgent to <code>request_url</code> which is appended with &#x27;?prompt=login&#x27;. This
will make hydra ignore the existing authentication, and allow your login
provider to login a different subject.</p><p>For more information on <code>prompt=login</code> and other options, please check
<a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest" target="_blank" rel="noopener noreferrer">Authentication Request</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cors"></a>CORS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cors" title="Direct link to heading">#</a></h2><p>Both ORY Hydra&#x27;s Admin and Public endpoints support CORS. For detailed
information, head over to the exemplary
<a href="https://github.com/ory/hydra/blob/master/docs/config.yaml" target="_blank" rel="noopener noreferrer">config file</a>.</p><p>For CORS to work properly, we encourage to set the following values:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">serve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">allowed_origins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//example.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//*.example.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">allowed_methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> POST</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> GET</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PUT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PATCH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DELETE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">allowed_headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> Authorization</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">exposed_headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> Content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">Type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">public</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">allowed_origins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//example.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//*.example.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">allowed_methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> POST</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> GET</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PUT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PATCH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DELETE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">allowed_headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> Authorization</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">exposed_headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> Content</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">Type</span></div></div></div></div></div><p>Keep in mind that the OAuth 2.0 Authorization Endpoint (<code>/oauth2/auth</code>) does not
expose CORS by design. This endpoint should never be consumed in a CORS-fashion.
Some endpoints (<code>/oauth2/token</code>, <code>/userinfo</code>, <code>/oauth2/revoke</code>) additionally
include URLs listed in field <code>allowed_cors_origins</code> of the OAuth 2.0 Client that
is making the request. For example, OAuth 2.0 Client</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;client_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;allowed_cors_origins&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://foo-bar.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>is allowed to make CORS request to <code>/oauth2/token</code> from origin
<code>https://foo-bar.com/</code> even if that origin is not listed in
<code>public.cors.allowed_origins</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cookies"></a>Cookies<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cookies" title="Direct link to heading">#</a></h2><p>By default, cookies sent by the Hydra Public endpoints are set without
explicitly specifying a SameSite mode. If you wish for these cookies to be set
with a mode you can use the <code>serve.cookies.same_site_mode</code> setting. Possible
values are <code>Strict</code>, <code>Lax</code> or <code>None</code>.</p><p>If you wish to embed requests to hydra on a third party site (for example an
iframe that periodically polls to check session status) you will need to set the
mode to <code>None</code>.</p><p>Some
<a href="https://www.chromium.org/updates/same-site/incompatible-clients" target="_blank" rel="noopener noreferrer">browser versions</a>
reject cookies using the <code>Same-Site=None</code> attribute. Hydra implements a
<a href="https://web.dev/samesite-cookie-recipes/#handling-incompatible-clients" target="_blank" rel="noopener noreferrer">workaround</a>
that can be enabled by setting <code>serve.cookies.same_site_legacy_workaround</code> to
<code>true</code>. This workaround is disabled by default, and only takes effect when
<code>serve.cookies.same_site_mode</code> is set to <code>None</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/hydra/edit/master/docs/versioned_docs/version-v1.5/advanced.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-06-16T15:14:10.000Z" class="docLastUpdatedAt_217_">6/16/2020</time> by <strong>aeneasr</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/hydra/docs/v1.5/debugging"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Common Problems &amp; Debugging</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/hydra/docs/v1.5/integration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Consuming OAuth 2.0 Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#self-signed-ssl" class="table-of-contents__link">Self-Signed SSL</a></li><li><a href="#mobile--browser-spa-authorization" class="table-of-contents__link">Mobile &amp; Browser (SPA) Authorization</a><ul><li><a href="#creating-a-public-oauth-20-client" class="table-of-contents__link">Creating a public OAuth 2.0 Client</a></li></ul></li><li><a href="#key-rotation" class="table-of-contents__link">Key rotation</a><ul><li><a href="#rotation-of-json-web-token-signing-keys" class="table-of-contents__link">Rotation of JSON Web Token Signing Keys</a></li><li><a href="#rotation-of-hmac-token-signing-and-database-and-cookie-encryption-keys" class="table-of-contents__link">Rotation of HMAC Token Signing and Database and Cookie Encryption Keys</a></li></ul></li><li><a href="#oauth-20" class="table-of-contents__link">OAuth 2.0</a><ul><li><a href="#audience" class="table-of-contents__link">Audience</a></li><li><a href="#json-web-tokens" class="table-of-contents__link">JSON Web Tokens</a></li><li><a href="#oauth-20-client-authentication-with-privatepublic-keypairs" class="table-of-contents__link">OAuth 2.0 Client Authentication with private/public keypairs</a></li></ul></li><li><a href="#openid-connect" class="table-of-contents__link">OpenID Connect</a><ul><li><a href="#subject-identifier-algorithms" class="table-of-contents__link">Subject Identifier Algorithms</a></li><li><a href="#using-login_hint-with-different-subject" class="table-of-contents__link">Using login_hint with Different Subject</a></li></ul></li><li><a href="#cors" class="table-of-contents__link">CORS</a></li><li><a href="#cookies" class="table-of-contents__link">Cookies</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 ORY GmbH</div></div></div><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>document.querySelectorAll(".tabs .tabs-nav .nav-item a").forEach((function(t){t.addEventListener("click",(function(e){return e.preventDefault(),t.closest(".tabs-nav").querySelectorAll(".nav-item a").forEach((function(t){t.classList.remove("active")})),t.closest(".tabs").querySelectorAll(".tab-content .tab-pane").forEach((function(t){t.classList.remove("active")})),t.classList.add("active"),document.getElementById(t.href.split("#")[1]).classList.add("active"),!1}))}))</script></footer></div>
<script src="/hydra/docs/styles.6111e368.js"></script>
<script src="/hydra/docs/runtime~main.2a596a0f.js"></script>
<script src="/hydra/docs/main.dd4aba0b.js"></script>
<script src="/hydra/docs/2.d59282e2.js"></script>
<script src="/hydra/docs/3.166acb7c.js"></script>
<script src="/hydra/docs/1be78505.331aa41c.js"></script>
<script src="/hydra/docs/f9e517e8.d3a3116c.js"></script>
<script src="/hydra/docs/256.4df904be.js"></script>
<script src="/hydra/docs/255.4e0cfe55.js"></script>
<script src="/hydra/docs/b54541be.e91639e2.js"></script>
<script src="/hydra/docs/17896441.3874ea07.js"></script>
<script src="/hydra/docs/e79af006.89b09352.js"></script>
</body>
</html>