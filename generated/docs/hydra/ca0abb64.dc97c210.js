(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{212:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return h}));var o=n(2),a=n(9),r=(n(0),n(244)),s={id:"oauth2",title:"OAuth 2.0"},i={id:"concepts/oauth2",isDocsHomePage:!1,title:"OAuth 2.0",description:"This section describes on a high level what OAuth 2.0 is and how it works.",source:"@site/docs/concepts/oauth2.md",permalink:"/hydra/docs/next/concepts/oauth2",editUrl:"https://github.com/ory/hydra/edit/master/docs/docs/concepts/oauth2.md",version:"next",lastUpdatedBy:"aeneasr",lastUpdatedAt:1594375370,sidebar:"docs",previous:{title:"Installation",permalink:"/hydra/docs/next/install"},next:{title:"OpenID Connect (OIDC)",permalink:"/hydra/docs/next/concepts/openid-connect-oidc"},latestVersionMainDocPermalink:"/hydra/docs"},c=[{value:"OAuth 2.0",id:"oauth-20",children:[]},{value:"Terminology",id:"terminology",children:[]},{value:"OAuth 2.0 Scope",id:"oauth-20-scope",children:[]},{value:"OAuth 2.0 Access Token Audience",id:"oauth-20-access-token-audience",children:[]},{value:"OAuth 2.0 Refresh Tokens",id:"oauth-20-refresh-tokens",children:[]},{value:"OAuth 2.0 Token Introspection",id:"oauth-20-token-introspection",children:[]}],l={rightToc:c};function h(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This section describes on a high level what OAuth 2.0 is and how it works."),Object(r.b)("h3",{id:"oauth-20"},"OAuth 2.0"),Object(r.b)("p",null,Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://tools.ietf.org/html/rfc6749"}),"The OAuth 2.0 authorization framework")," is\nspecified in ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://tools.ietf.org/html/rfc6749"}),"IETF RFC 6749"),". OAuth 2.0\nenables a third-party application to obtain limited access to resources on an\nHTTP server on behalf of the owner of those resources."),Object(r.b)("p",null,"Why is this important? Without OAuth 2.0, a resource owner who wants to share\nresources in their account with a third party would have to share their\ncredentials with that third party. As an example, let's say you (a resource\nowner) have some photos (resources) stored on a social network (the resource\nserver). Now you want to print them using a third-party printing service. Before\nOAuth 2.0 existed, you would have to enter your social network password into the\nprinting service so that it can access and print your photos. Sharing secret\npasswords with third parties is obviously very problematic."),Object(r.b)("p",null,"OAuth addresses this problem by introducing:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"the distinction between resource ownership and resource access for clients"),Object(r.b)("li",{parentName:"ul"},"the ability to define fine-grained access privileges (called OAuth scopes)\ninstead of full account access for third parties"),Object(r.b)("li",{parentName:"ul"},"an authorization layer and workflow that allows resource owners to grant\nparticular clients particular types of access to particular resources.")),Object(r.b)("p",null,"With OAuth, clients can request access to resources on a server, and the owner\nof these resources can grant the requested access together with dedicated\ncredentials. In our example, you could grant the printing service read-only\naccess to your photos (only your photos, not your friend list) on the social\nnetwork. These credentials come in the form of an access token -- a string\ndenoting a specific scope, lifetime, and other access attributes. The client\n(printing service) can use this access token to request the protected resources\n(your photos) from the resource server (the social network)."),Object(r.b)("h3",{id:"terminology"},"Terminology"),Object(r.b)("p",null,"To read more natural, this guide uses simpler terminologies like ",Object(r.b)("em",{parentName:"p"},"user")," instead\nof ",Object(r.b)("em",{parentName:"p"},"resource owner"),". Here is a full list of terms."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"A ",Object(r.b)("strong",{parentName:"li"},"resource owner"),' is the user account who authorizes an external\napplication to access their account. This access is limited (scoped) to\nparticular actions (the granted "scopes" like read photos or write messages).\nThis guide refers to resource owners as ',Object(r.b)("em",{parentName:"li"},"users")," or ",Object(r.b)("em",{parentName:"li"},"end users"),"."),Object(r.b)("li",{parentName:"ol"},"The ",Object(r.b)("strong",{parentName:"li"},"OAuth 2.0 Authorization Server")," implements the OAuth 2.0 protocol (and\noptionally OpenID Connect). In our case, this is ",Object(r.b)("strong",{parentName:"li"},"ORY Hydra"),"."),Object(r.b)("li",{parentName:"ol"},"The ",Object(r.b)("strong",{parentName:"li"},"resource provider")," is the service that hosts (provides) the resources.\nThese resources (e.g. blog articles, printers, todo lists) are owned by a\nresource owner (user) mentioned above."),Object(r.b)("li",{parentName:"ol"},"The ",Object(r.b)("strong",{parentName:"li"},"OAuth 2.0 Client")," is the ",Object(r.b)("em",{parentName:"li"},"external application")," that wants to access a\nresource owner's resources (read a user's images). To do that, it asks the\nOAuth 2.0 Authorization Server for an access token in a resource owner's\nbehalf. The authorization server will ask the user if he/she \"is ok with\"\ngiving that external application e.g. write access to personal images."),Object(r.b)("li",{parentName:"ol"},"The ",Object(r.b)("strong",{parentName:"li"},"Identity Provider")," is a service that allows users to register\naccounts, log in, etc."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"User Agent")," is usually a browser."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"OpenID Connect")," is a protocol built on top of OAuth 2.0 for just\nauthentication (instead of authorizing access to resources).")),Object(r.b)("p",null,"A typical OAuth 2.0 flow looks as follows:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"A developer registers an OAuth 2.0 Client (external application) with the\nAuthorization Server (ORY Hydra) the intention to obtain information on\nbehalf of a user."),Object(r.b)("li",{parentName:"ol"},"The application UI asks the user to authorize the application to access\ninformation/data on his/her behalf."),Object(r.b)("li",{parentName:"ol"},"The user is redirected to the Authorization Server."),Object(r.b)("li",{parentName:"ol"},"The Authorization Server confirms the user's identity and asks the user to\ngrant the OAuth 2.0 Client certain permissions."),Object(r.b)("li",{parentName:"ol"},"The Authorization Server issues tokens that the OAuth 2.0 client uses to\naccess resources on the user's behalf.")),Object(r.b)("h3",{id:"oauth-20-scope"},"OAuth 2.0 Scope"),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(o.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(o.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(o.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(o.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(r.b)("div",Object(o.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The OAuth 2.0 Scope ",Object(r.b)("strong",{parentName:"p"},"is not an internal RBAC/ACL permission"),":"),Object(r.b)("ul",{parentName:"div"},Object(r.b)("li",{parentName:"ul"},"A permission allows an actor to perform a certain action in a system: ",Object(r.b)("em",{parentName:"li"},"Bob is\nallowed to delete his own photos"),"."),Object(r.b)("li",{parentName:"ul"},"OAuth 2.0 Scope implies that an end-user granted certain privileges to a\nclient: ",Object(r.b)("em",{parentName:"li"},"Bob allowed the OAuth 2.0 Client to delete all users"),". But Bob might\nnot be allowed to delete all users because Bob is not an admin.")),Object(r.b)("p",{parentName:"div"},'The OAuth 2.0 Scope can be granted without the end-user actually having the\nright permissions. In the examples above, Bob granted an OAuth 2.0 Client the\npermission ("scope") to delete all users in his name. However, since Bob is not\nan administrator, that permission ("access control") is not actually granted to\nBob. Therefore any request by the OAuth 2.0 Client that tries to delete users on\nbehalf of Bob should fail.'))),Object(r.b)("p",null,"A second important concept is the OAuth 2.0 Scope. Many people confuse OAuth 2.0\nScope with internal Access Control like for example Role Based Access Control\n(RBAC) or Access Control Lists (ACL). Both concepts cover different aspects of\naccess control."),Object(r.b)("p",null,"Internal access control (RBAC, ACL, etc) decides what a user can do in your\nsystem. An administrator might be allowed to modify everything. A regular user\nmight only be allowed to read their own messages."),Object(r.b)("p",null,"OAuth 2.0 Scopes, on the other hand, describe what a user allowed an external\napplication (OAuth 2.0 client) to do on his/her behalf. For example, an access\ntoken might grant the external application to see a user's pictures, but not\nupload new pictures on his/her behalf (which we assume a user could do herself)."),Object(r.b)("p",null,"In an extreme case, the user could lie and grant an external application OAuth\nscopes that he himself doesn't have permission to (\"read all classified\ndocuments\"). The OAuth Access Token with those scopes wouldn't help the external\napplication read those documents because it can only act in the name of the\nuser, and that user doesn't have these access privileges."),Object(r.b)("p",null,"To recap, ORY Hydra's primary feature is implementing the OAuth 2.0 and OpenID\nConnect spec, as well as related specs by the IETF and OpenID Foundation."),Object(r.b)("p",null,"The next sections explain how to connect your existing user management (user\nlogin, registration, logout, ...) with ORY Hydra in order to become an OAuth 2.0\nand OpenID Connect provider like Google, Dropbox, or Facebook."),Object(r.b)("p",null,"Again, please be aware that you must know how OAuth 2.0 and OpenID Connect work.\nThis documentation will not teach you how these protocols work."),Object(r.b)("p",null,"The scope of an OAuth 2.0 scope defines the permission the token was granted by\nthe end-user. For example, a specific token might be allowed to access public\npictures, but not private ones. The granted permissions are established during\nthe consent screen."),Object(r.b)("p",null,"ORY Hydra has pre-defined OAuth 2.0 Scope values:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"offline_access"),": Include this scope if you wish to receive a refresh token"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"openid"),": Include this scope if you wish to perform an OpenID Connect request.")),Object(r.b)("p",null,"When performing an OAuth 2.0 Flow where the end-user is involved (e.g. Implicit\nor Authorize Code), the granted OAuth 2.0 Scope must be set when accepting the\nconsent using the ",Object(r.b)("inlineCode",{parentName:"p"},"grant_scope")," key."),Object(r.b)("h3",{id:"oauth-20-access-token-audience"},"OAuth 2.0 Access Token Audience"),Object(r.b)("p",null,"The Audience of an Access Token refers to the Resource Servers that this token\nis intended for. The audience usually refers to one or more URLs such as"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"https://api.mydomain.com/blog/posts")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"https://api.mydomain.com/users"))),Object(r.b)("p",null,"but may also refer to a subset of resources:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"https://api.mydomain.com/tenants/foo/users"))),Object(r.b)("p",null,"When performing an OAuth 2.0 Flow where the end-user is involved (e.g. Implicit\nor Authorize Code), the granted audience must be set when accepting the consent\nusing the ",Object(r.b)("inlineCode",{parentName:"p"},"grant_access_token_audience")," key. In most cases, it is ok to grant\nthe audience without user-interaction."),Object(r.b)("h3",{id:"oauth-20-refresh-tokens"},"OAuth 2.0 Refresh Tokens"),Object(r.b)("p",null,"OAuth 2.0 Refresh Tokens are issued only when an Authorize Code Flow\n(",Object(r.b)("inlineCode",{parentName:"p"},"response_type=code"),") or an OpenID Connect Hybrid Flow with an Authorize Code\nResponse Type (",Object(r.b)("inlineCode",{parentName:"p"},"response_type=code+..."),") is executed. OAuth 2.0 Refresh Tokens\nare not returned for Implicit or Client Credentials grants:"),Object(r.b)("p",null,"Capable of issuing an OAuth 2.0 Refresh Token:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/auth?response_type=code&"}),"https://ory-hydra.example/oauth2/auth?response_type=code&"),"..."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/auth?response_type=code+token&"}),"https://ory-hydra.example/oauth2/auth?response_type=code+token&"),"..."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/auth?response_type=code+token+id_token&"}),"https://ory-hydra.example/oauth2/auth?response_type=code+token+id_token&"),"..."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/auth?response_type=code+id_token&"}),"https://ory-hydra.example/oauth2/auth?response_type=code+id_token&"),"...")),Object(r.b)("p",null,"Will not issue an OAuth 2.0 Refresh Token:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/auth?response_type=token&"}),"https://ory-hydra.example/oauth2/auth?response_type=token&"),"..."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/auth?response_type=token+id_token&"}),"https://ory-hydra.example/oauth2/auth?response_type=token+id_token&"),"..."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(o.a)({parentName:"li"},{href:"https://ory-hydra.example/oauth2/token?grant_type=client_redentials&"}),"https://ory-hydra.example/oauth2/token?grant_type=client_redentials&"),"...")),Object(r.b)("p",null,"Additionally, each OAuth 2.0 Client that wants to request an OAuth 2.0 Refresh\nToken must be allowed to request scope ",Object(r.b)("inlineCode",{parentName:"p"},"offline_access"),". When performing an\nOAuth 2.0 Authorize Code Flow, the ",Object(r.b)("inlineCode",{parentName:"p"},"offline_access")," value must be included in\nthe requested OAuth 2.0 Scope:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{}),"https://authorization-server.com/auth\n &scope=offline_access\n ?response_type=code\n &client_id=...\n &redirect_uri=...\n &state=...\n")),Object(r.b)("p",null,"When ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"concepts/consent"}),"accepting the consent request"),", ",Object(r.b)("inlineCode",{parentName:"p"},"offline_access")," must be\nin the list of ",Object(r.b)("inlineCode",{parentName:"p"},"grant_scope"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"}),"fetch('https://hydra/oauth2/auth/requests/consent/accept?challenge=' + encodeURIComponent(challenge), {\n    method: 'PUT',\n    body: JSON.stringify(body),\n    headers: { 'Content-Type': 'application/json' }\n}).\nconst body = {\n    grant_scope: [\"offline_access\"],\n}\n")),Object(r.b)("p",null,"Refresh Token Lifespan can be set using configuration key ",Object(r.b)("inlineCode",{parentName:"p"},"ttl.refresh_token"),".\nIf set to -1, Refresh Tokens never expire."),Object(r.b)("h3",{id:"oauth-20-token-introspection"},"OAuth 2.0 Token Introspection"),Object(r.b)("p",null,"OAuth2 Token Introspection is an ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://tools.ietf.org/html/rfc7662"}),"IETF"),"\nstandard. It defines a method for a protected resource to query an OAuth 2.0\nauthorization server to determine the active state of an OAuth 2.0 token and to\ndetermine meta-information about this token. OAuth 2.0 deployments can use this\nmethod to convey information about the authorization context of the token from\nthe authorization server to the protected resource."),Object(r.b)("p",null,"The usage of an access token or client credentials is required to access the\nendpoint. ORY Hydra will however accept any valid token or valid credentials as\nthere is no built-in access control."))}h.isMDXComponent=!0},244:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),h=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=h(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=h(n),b=o,d=p["".concat(s,".").concat(b)]||p[b]||u[b]||r;return n?a.a.createElement(d,i(i({ref:t},l),{},{components:n})):a.a.createElement(d,i({ref:t},l))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=b;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var l=2;l<r;l++)s[l]=n[l];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);