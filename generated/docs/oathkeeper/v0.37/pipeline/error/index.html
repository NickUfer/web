<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-71865250-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Oathkeeper" href="/oathkeeper/docs/opensearch.xml"><title data-react-helmet="true">Error Handlers | ORY Oathkeeper</title><meta data-react-helmet="true" name="docsearch:version" content="v0.37"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Error Handlers | ORY Oathkeeper"><meta data-react-helmet="true" name="description" content="A error handler is responsible for executing logic after, for example,"><meta data-react-helmet="true" property="og:description" content="A error handler is responsible for executing logic after, for example,"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//oathkeeper/docs/v0.37/pipeline/error"><link data-react-helmet="true" rel="shortcut icon" href="/oathkeeper/docs/img/favico.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//oathkeeper/docs/v0.37/pipeline/error"><link rel="stylesheet" href="/oathkeeper/docs/styles.58b6db02.css">
<link rel="preload" href="/oathkeeper/docs/styles.9bcf35c1.js" as="script">
<link rel="preload" href="/oathkeeper/docs/runtime~main.f5754c1a.js" as="script">
<link rel="preload" href="/oathkeeper/docs/main.3e781056.js" as="script">
<link rel="preload" href="/oathkeeper/docs/1.ca0cd187.js" as="script">
<link rel="preload" href="/oathkeeper/docs/2.16812950.js" as="script">
<link rel="preload" href="/oathkeeper/docs/1be78505.a30fcfa8.js" as="script">
<link rel="preload" href="/oathkeeper/docs/f9e517e8.eb41e83c.js" as="script">
<link rel="preload" href="/oathkeeper/docs/51.c6ee05f3.js" as="script">
<link rel="preload" href="/oathkeeper/docs/50.94cb6e80.js" as="script">
<link rel="preload" href="/oathkeeper/docs/80b2fd12.f12d2f41.js" as="script">
<link rel="preload" href="/oathkeeper/docs/17896441.500c0190.js" as="script">
<link rel="preload" href="/oathkeeper/docs/40fb4cf7.b3d2c589.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/oathkeeper/docs/img/logo-oathkeeper.svg" alt="ORY Oathkeeper"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/oathkeeper/docs/">Docs</a><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ecosystem</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat</a><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/oathkeeper/docs/versions">v0.38</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/oathkeeper/docs/img/logo-oathkeeper.svg" alt="ORY Oathkeeper"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/oathkeeper/docs/">Docs</a></li><li class="menu__list-item"><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Ecosystem</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="menu__link">Forum</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Chat</a></li><li class="menu__list-item"><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/oathkeeper/docs/versions">v0.38</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/oathkeeper/docs/v0.37/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/oathkeeper/docs/v0.37/install">Installation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Core Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/v0.37/api-access-rules">API Access Rules</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Handlers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/v0.37/pipeline/index">Access Rule Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/v0.37/pipeline/authn">Authenticators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/v0.37/pipeline/authz">Authorizers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/v0.37/pipeline/mutator">Mutators</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/oathkeeper/docs/v0.37/pipeline/error">Error Handlers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/oathkeeper/docs/v0.37/configure-deploy">Configure and Deploy</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/oathkeeper/docs/v0.37/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/oathkeeper/docs/v0.37/reference/api">REST API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/oathkeeper/docs/v0.37/sdk/index">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Kratos</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/kratos" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/kratos/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Hydra</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/hydra" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/hydra/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/hydra" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Keto</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/Keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/Keto/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/Keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for ORY Oathkeeper <strong>vv0.37</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/oathkeeper/docs/pipeline/error">latest version</a></strong> (v0.38).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: v0.37</span></div><header><h1 class="docTitle_1Lrw">Error Handlers</h1></header><div class="markdown"><p>A error handler is responsible for executing logic after, for example,
authentication or authorization failed. ORY Oathkeeper supports different error
handlers and we will add more as the project progresses.</p><p>A error handler can be configured to match on certain conditions, for example,
it is possible to configure the <code>json</code> error handler to only be executed if the
HTTP Header <code>Accept</code> contains <code>application/json</code>.</p><p>Each error handler has two keys:</p><ul><li><code>handler</code> (string, required): Defines the handler (e.g. <code>noop</code>) to be used.</li><li><code>config</code> (object, optional): Configures the handler. Configuration keys vary
per handler. The configuration can be defined in the global configuration
file, or per access rule.</li></ul><p><strong>Example</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;errors&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;handler&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;json&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;config&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>You can define more than one error handler in the Access Rule. Depending on
their matching conditions (see next chapter), the appropriate error handler will
be chosen.</p><p>Please be aware that defining error handlers with overlapping matching
conditions will cause errors, because ORY Oathkeeper will not know which error
handler to execute!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="error-matching"></a>Error Matching<a aria-hidden="true" tabindex="-1" class="hash-link" href="#error-matching" title="Direct link to heading">#</a></h2><p>You can configure the error handlers in such a way, that - for example - ORY
Oathkeeper responds, in the case of an error, with</p><ul><li>a JSON response, such as
<code>{&quot;error&quot;:{&quot;code&quot;:403,&quot;status&quot;:&quot;Forbidden&quot;,&quot;message&quot;:&quot;Access credentials are not sufficient to access this resource&quot;}}</code>,
when the client that expects JSON (<code>Accept: application/json</code>);</li><li>an XML response when the API Client expects XML (<code>Accept: application/xml</code>);</li><li>a HTTP Redirect (HTTP Status Found - 302) to <code>/login</code> when the endpoint is
directly (no AJAX) accessed from a browser
(<code>Accept: text/html,application/xhtml+xml</code>).</li></ul><p>There are also other possible matching strategies - such as defining a response
per error type (unauthorized, forbidden, internal_server_error, ...) , per HTTP
<code>Content-Type</code> Header (similar to <code>Accept</code>), or based on the Remote IP Address.</p><p>All match definitions are set in the handler&#x27;s config, using the <code>when</code> key.
This is the same for all handlers!</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json5 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  handler: &#x27;json&#x27;, // or redirect, www_authenticate, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    when: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        error: [&#x27;unauthorized&#x27;, &#x27;...&#x27;, &#x27;...&#x27;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>If <code>when</code> is empty, then no conditions are applied and the error handler is
always matching! In fact, this is also true for all subkeys. If left empty, the
matching condition will not be applied and is thus always true!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fallback"></a>Fallback<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fallback" title="Direct link to heading">#</a></h3><p>Error handling can be set globally and per access rule. ORY Oathkeeper will
first check for any access rule specific error handling before falling back to
the globally defined error handling.</p><p>Similar to other pipeline handlers (authentication, authorization, mutation),
you must enable the error handlers in the global ORY Oathkeeper config, except
for the <code>json</code> error handler which is always enabled by default:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">handlers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># this is true by default</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># config:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   when: ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">redirect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># this is false by default</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># config:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   when: ...</span></div></div></div></div></div><p>As discussed in the previous section, when <code>config.when</code> is empty, the error
handler will always match. This of course is a problem because ORY Oathkeeper
now does not know if it should redirect or send a JSON error!</p><p>Therefore, an additional configuration - called <code>fallback</code> - is available:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># `[&quot;json&quot;]` is the default!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">fallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">handlers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># this is true by default</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># config:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   when: ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">redirect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># this is false by default</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">to</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//mywebsite/login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># when: ...</span></div></div></div></div></div><p>This feature tells ORY Oathkeeper that the <code>json</code> error handler should be used
as fallback. You could also define multiple fallback handlers - the first
matching handler will be the one and only executed! This makes sense if you
additionally configure the <code>when</code> section:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">fallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> redirect</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">handlers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">redirect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">accept</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> text/*</span></div></div></div></div></div><p>In this configuration example, ORY Oathkeeper would first check if the HTTP
Request Header contains <code>Accept: text/html</code> (or <code>text/xhtml</code>, <code>text/text</code>, ...)
and if not, would return a JSON Error Message.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="matchers"></a>Matchers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#matchers" title="Direct link to heading">#</a></h3><p>All matchers are defined under the <code>config.when</code> key of the error handler, both
in the global config and in the access rule:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json5 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// access-rule.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  handler: &#x27;json&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    when: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        error: [&#x27;unauthorized&#x27;, &#x27;...&#x27;, &#x27;...&#x27;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">handlers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">redirect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> unauthorized</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> authentication_handler_no_match</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span></div></div></div></div></div><p>You can define multiple when clauses which allows you to differentiate between
error types and HTTP Requests. The when sections are combined with <code>OR</code> while
the subkeys (<code>error</code>, <code>request.header.accept</code>, <code>request.header.content_type</code>,
...) are matched with <code>AND</code>. Keys that have arrays as values (<code>error</code>,
<code>request.header.accept</code>, <code>request.header.content_type</code>, ...) are usually matched
with <code>OR</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">handlers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">redirect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> unauthorized</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> internal_server_error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># AND</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">remote_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 192.168.1.0/24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 192.178.1.0/24</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> forbidden</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> not_found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># AND</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">accept</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> text/html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> text/xhtml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># AND</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">content_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> application/x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">www</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">urlencoded</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> multipart/form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">data</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="error"></a>Error<a aria-hidden="true" tabindex="-1" class="hash-link" href="#error" title="Direct link to heading">#</a></h4><p>The <code>config.when.#.error</code> key may contain zero, one, or multiple error names
that must match for this matching condition to be true. The error names are
derived (lowercase and whitespaces replaced with <code>_</code>) from the well-defined
<a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="noopener noreferrer">HTTP Status</a> messages
such as <code>Not Found</code>, <code>Forbidden</code>, <code>Internal Server Error</code>, and so on.</p><p>Here are some examples:</p><ul><li><code>Internal Server Error</code> (500) -&gt; <code>{&quot;errors&quot;: [&quot;internal_server_error&quot;]}</code></li><li><code>Forbidden</code> (403) -&gt; <code>{&quot;errors&quot;: [&quot;forbidden&quot;]}</code></li><li><code>Not Found</code> (404) -&gt; <code>{&quot;errors&quot;: [&quot;not_found&quot;]}</code></li><li><code>Bad Request</code> (400) -&gt; <code>{&quot;errors&quot;: [&quot;bad_request&quot;]}</code></li></ul><p>Keep in mind that these errors must be emitted by ORY Oathkeeper itself, not by
the upstream API. Therefore, most HTTP Status Codes will not have any effect
because ORY Oathkeeper - as of now - mostly returns 401, 403, 500 error codes.</p><p>As discussed previously, if this configuration key is left empty, then all error
types will match!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="http-request-remote-ip"></a>HTTP Request: Remote IP<a aria-hidden="true" tabindex="-1" class="hash-link" href="#http-request-remote-ip" title="Direct link to heading">#</a></h4><p>The HTTP Remote IP is the IP of the Client that initially made the request. The
Remote Address is matched using
<a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CIDR Notation</a>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">remote_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 192.168.1.0/24</span></div></div></div></div></div><p>This configuration would match a HTTP Request coming directly from
<code>192.168.1.1</code>, <code>192.168.1.2</code>, and so on.</p><p>If ORY Oathkeeper runs behind a Load Balancer or any other type of Reverse
Proxy, you can configure ORY Oathkeeper to check the
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" target="_blank" rel="noopener noreferrer"><code>X-Forwarded-For</code> HTTP Header</a>
header as well:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">remote_ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">respect_forwarded_for_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># defaults to false</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 192.168.1.0/24</span></div></div></div></div></div><p>As discussed previously, if this configuration key is left empty, then all
remote IPs will match!</p><p>HTTP Requests that include one of the matching IP Addresses in the
<code>X-Forwaded-For</code> HTTP Header, for example
<code>X-Forwarded-For: 123.123.123.123, ..., 192.168.1.1, ...</code>, now match this error
handler.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="http-request-header-accept"></a>HTTP Request Header: Accept<a aria-hidden="true" tabindex="-1" class="hash-link" href="#http-request-header-accept" title="Direct link to heading">#</a></h4><p>The HTTP <code>Accept</code> Header is the most common way to tell an HTTP API what MIME
content type is expected. For example, FireFox sends
<code>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code> for
all regular requests (e.g. when opening <a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer">www.ory.sh</a>). And
a REST API Client usually sends <code>Accept: application/json</code>.</p><p>Therefore, using the <code>Accept</code> header is one of the most common ways to
distinguish between &quot;regular&quot; browser traffic, REST API traffic, and other types
of HTTP traffic.</p><p>In ORY Oathkeeper, you can specify the matching conditions for the Accept header
as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">accept</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> text/html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> text/*</span></div></div></div></div></div><p>The defined matching condition would apply if a client sends one of the
following <code>Accept</code> headers:</p><ul><li><code>Accept: text/html</code></li><li><code>Accept: text/xhtml</code></li><li><code>Accept: text/xhtml+xml</code></li><li><code>Accept: text/...</code></li><li><code>Accept: text/*</code></li></ul><p>Most browsers (see the FireFox example) also send wildcard <code>Accept</code> headers such
as <code>*/*</code>. To prevent multiple conditions to match, HTTP Accept Headers from the
client are interpreted literally, meaning that wildcards are not interpreted.</p><p>Assuming the client sends <code>Accept: */*</code> and the error condition is set to
<code>accept: [&quot;text/text&quot;]</code>, the error condition would not match. If however the
client sends <code>Accept: text/text</code> and the error condition is set to
<code>accept: [&quot;*/*&quot;]</code>, then the condition would match.</p><p>To match against wildcards in the <code>Accept</code> header, you have to explicitly define
them in the error condition. Setting the configuration to <code>accept: [&quot;*/*&quot;]</code> will
match <code>Accept: */*</code> and of course any other type such as <code>Accept: text/*</code>
<code>Accept: text/html</code>, and so on.</p><p>As discussed previously, if this configuration key is left empty, then all
<code>Accept</code> headers will match!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="http-request-header-content-type"></a>HTTP Request Header: Content-Type<a aria-hidden="true" tabindex="-1" class="hash-link" href="#http-request-header-content-type" title="Direct link to heading">#</a></h4><p>The
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener noreferrer">HTTP Content Type</a>
matcher works similar to the <code>Accept</code> header. The HTTP Content Type Header
however is much less common, as it is only used in POST, PUT, PATCH requests (or
any other requests that send a HTTP Body).</p><p>The main difference however is that the client never (unless it sends malformed
data) sends wildcard MIME types, as the MIME type needs to be deterministic.
It&#x27;s typically something like <code>multipart/form-data</code>,
<code>application/x-www-form-urlencoded</code>, or <code>application/json</code>.</p><p>In ORY Oathkeeper, you can specify the matching conditions for the
<code>Content-Type</code> header as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">content_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> multipart/form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> application/x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">www</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">urlencoded</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> application/json</span></div></div></div></div></div><p>As discussed previously, if this configuration key is left empty, then all
<code>Content-Type</code> headers will match!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="error-handlers"></a>Error Handlers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#error-handlers" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="json"></a><code>json</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#json" title="Direct link to heading">#</a></h3><p>The <code>json</code> Error Handler returns an <code>application/json</code> response type. Per
default, error messages are stripped of their details to reduce OSINT attack
surface. You can enable more detailed error messages by setting <code>verbose</code> to
<code>true</code>. As discussed in the previous section, you can define error matching
conditions under the <code>when</code> key.</p><p><strong>Example</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json5 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// access-rule.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  handler: &#x27;json&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose: true, // defaults to false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    when: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="redirect"></a><code>redirect</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#redirect" title="Direct link to heading">#</a></h3><p>The <code>redirect</code> Error Handler returns a HTTP 302/301 response with a <code>Location</code>
Header. As discussed in the previous section, you can define error matching
conditions under the <code>when</code> key.</p><p><strong>Example</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json5 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// access-rule.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  handler: &#x27;json&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    to: &#x27;http://my-website/login&#x27;, // required!!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    code: 301, // defaults to 302 - only 301 and 302 are supported.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    when: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="www_authenticate"></a><code>www_authenticate</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#www_authenticate" title="Direct link to heading">#</a></h3><p>The <code>www_authenticate</code> Error Handler responds with HTTP 401 and a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate" target="_blank" rel="noopener noreferrer"><code>WWW-Authenticate</code></a>
HTTP Header.</p><p>You can configure the <code>realm</code> the browser will display. The <code>realm</code> is a message
that will be displayed by the browser. Most browsers show a message like &quot;The
website says: <code>&lt;realm&gt;</code>&quot;. Using a real message is thus more appropriate than a
Realm identifier.</p><p>This error handler is &quot;exotic&quot; as WWW-Authenticate is not a common pattern in
today&#x27;s web. As discussed in the previous section, you can define error matching
conditions under the <code>when</code> key.</p><p><strong>Example</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json5 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// access-rule.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  handler: &#x27;json&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    realm: &#x27;Please enter your username and password&#x27;, // Defaults to `Please authenticate.`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    when: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/oathkeeper/edit/master/docs/versioned_docs/version-v0.37/pipeline/error.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-04-21T15:23:52.000Z" class="docLastUpdatedAt_217_">4/21/2020</time> by <strong>hackerman</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/oathkeeper/docs/v0.37/pipeline/mutator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Mutators</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/oathkeeper/docs/v0.37/configure-deploy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure and Deploy Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#error-matching" class="table-of-contents__link">Error Matching</a><ul><li><a href="#fallback" class="table-of-contents__link">Fallback</a></li><li><a href="#matchers" class="table-of-contents__link">Matchers</a></li></ul></li><li><a href="#error-handlers" class="table-of-contents__link">Error Handlers</a><ul><li><a href="#json" class="table-of-contents__link"><code>json</code></a></li><li><a href="#redirect" class="table-of-contents__link"><code>redirect</code></a></li><li><a href="#www_authenticate" class="table-of-contents__link"><code>www_authenticate</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 ORY GmbH</div></div></div><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>document.querySelectorAll(".tabs .tabs-nav .nav-item a").forEach((function(t){t.addEventListener("click",(function(e){return e.preventDefault(),t.closest(".tabs-nav").querySelectorAll(".nav-item a").forEach((function(t){t.classList.remove("active")})),t.closest(".tabs").querySelectorAll(".tab-content .tab-pane").forEach((function(t){t.classList.remove("active")})),t.classList.add("active"),document.getElementById(t.href.split("#")[1]).classList.add("active"),!1}))}))</script></footer></div>
<script src="/oathkeeper/docs/styles.9bcf35c1.js"></script>
<script src="/oathkeeper/docs/runtime~main.f5754c1a.js"></script>
<script src="/oathkeeper/docs/main.3e781056.js"></script>
<script src="/oathkeeper/docs/1.ca0cd187.js"></script>
<script src="/oathkeeper/docs/2.16812950.js"></script>
<script src="/oathkeeper/docs/1be78505.a30fcfa8.js"></script>
<script src="/oathkeeper/docs/f9e517e8.eb41e83c.js"></script>
<script src="/oathkeeper/docs/51.c6ee05f3.js"></script>
<script src="/oathkeeper/docs/50.94cb6e80.js"></script>
<script src="/oathkeeper/docs/80b2fd12.f12d2f41.js"></script>
<script src="/oathkeeper/docs/17896441.500c0190.js"></script>
<script src="/oathkeeper/docs/40fb4cf7.b3d2c589.js"></script>
</body>
</html>